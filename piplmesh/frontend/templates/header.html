{% load i18n facebook %}
<div id="container">
    <div id="header">
        <div id="logo">
            <a href="{% url home %}">
                <img src="{{ STATIC_URL }}piplmesh/images/logo-{{ LANGUAGE_CODE }}.png" alt="PiplMesh" />
            </a>
        </div>
        <div id="search">
            <img id="search_logo" src="{{ STATIC_URL }}piplmesh/images/google.png" alt="Google" />
            <div id="cse_search_form"></div>
            <script src="https://www.google.com/jsapi" type="text/javascript"></script>
            <script type="text/javascript">
                var language_code = '{{ LANGUAGE_CODE|escapejs }}';
                var search_engine_unique_id = '{{ SEARCH_ENGINE_UNIQUE_ID|escapejs }}';
                var search_page_url = '{% filter escapejs %}{% url search %}{% endfilter %}';
            </script>
            <script type="text/javascript" src="{{ STATIC_URL }}piplmesh/js/search_bar.js"></script>
            {% if "q" in request.GET %}
                {% trans "See your query results on " %}<a id="google_results_link">Google</a>.
            {% endif %}
        </div>
        {% with next|default:redirect_to|default:request.get_full_path as next_url %}
            <ul class="user">
                {% comment %}
                    This list is used for registration and login link.
                    If user is already logged in, logout link is shown instead.
                {% endcomment %}
                {% if user.is_authenticated %}
                    {% if user.facebook_id %}
                        <li class="image"><img src="{% facebook_picture user.facebook_id "square" %}" alt="{% trans "User picture" %}" /></li>
                    {% else %}
                        <li class="image"><img src="{{ STATIC_URL }}piplmesh/images/unknown.png" height="50" width="50" alt="{% trans "User picture" %}" /></li>
                    {% endif %}
                    <li class="username">{{ user.username }}</li>
                    <li class="last">
                        <form method="post" action="{% url logout %}" id="logout_form">
                            {% csrf_token %}
                            <div>
                                <input type="hidden" name="{{ REDIRECT_FIELD_NAME }}" value="{{ next_url }}" />
                                <button type="submit" class="auth_button" value="value">{% trans "Logout" %}</button>
                            </div>
                        </form>
                    </li>
                {% else %}
                    <li><a href="{% url login %}?{{ REDIRECT_FIELD_NAME }}={{ next_url }}">{% trans "Login" %}</a></li>
                    <li class="last"><a href="{% url registration %}">{% trans "Register" %}</a></li>
                {% endif %}
            </ul>
        {% endwith %}
    </div>
</div>
